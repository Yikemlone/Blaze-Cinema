@page "/profile"
@attribute [Authorize(Policy = "IsCustomer")]
@inject HttpClient Http
@using Cinema.Shared.DTO

<PageTitle>Profile</PageTitle>

<AuthorizeView>
    <Authorized>
        Hello, @context.User.Identity?.Name!
    </Authorized>
</AuthorizeView>

@code {
    private List<BookingDTO> _bookings;
    private UserInfo _userInfo;

    protected override async Task OnInitializedAsync()
    {
        _userInfo = await GetUserInfoAsync();
        _bookings = await GetBookingsAsync();
    }

    private async Task<List<BookingDTO>> GetBookingsAsync()
    {
        return await Http.GetFromJsonAsync<List<BookingDTO>>("api/booking/" + _userInfo.UserID);
    }

    public async Task<UserInfo> GetUserInfoAsync()
    {
        return await Http.GetFromJsonAsync<UserInfo>("api/Authorize/UserInfo");
    }
}
