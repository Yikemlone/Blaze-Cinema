@using Cinema.Shared.DTO
@inherits ComponentBase

@if (Movie != null) 
{
    <MudContainer Class="mt-16 px-8" MaxWidth="MaxWidth.False">
        <MudGrid Spacing="3">

            <MudItem xs="6" sm="6" md="12">
                <MudText Typo="Typo.h3"> @Movie.Name </MudText>
            </MudItem>
            
            <MudItem xs="6" sm="6" md="2">
                <MudImage Src="@_imageURL" ObjectFit="ObjectFit.Cover" Width="200"/>
            </MudItem>

            <MudStack>
                <MudText Typo="Typo.subtitle2">@Movie.AgeRating</MudText>
                <MudText Typo="Typo.subtitle2">@Movie.Duration minutes</MudText>
            </MudStack>
         
            <MudItem xs="8" sm="6" md="7">
                <MudContainer>
                    <MudText Typo="Typo.body1">@Movie.Description</MudText>
                </MudContainer>
            </MudItem>
            
            <MudItem xs="6" sm="8" md="12">
                <iframe src="https://www.youtube.com/embed/@Movie.Trailer"
                    style="width: 100%!important;height: 500px!important;"
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    allowfullscreen>
                </iframe>
            </MudItem>

        </MudGrid>
    </MudContainer>
}

@code {

    [Parameter]
    public int MovieID { get; set; }

    private const string API_URL = "api/movie";
    private string _imageURL;
    private HttpClient _client;

    public MovieDTO Movie { get; set; }
    //public List<ScreeningDTO> Screenings { get; set; } = new List<ScreeningDTO>();

    protected override async Task OnInitializedAsync()
    {
        _client = new HttpClient() { BaseAddress = new Uri("https://localhost:7016") };
        Movie = await GetMovieAsync();
        _imageURL = $"images/{Movie.ID}.jpg";
        //Screenings = await GetScreening(Movie.ID);
    }

    public async Task<MovieDTO> GetMovieAsync()
    {
        return await _client.GetFromJsonAsync<MovieDTO>(API_URL + $"/movies/{MovieID}");
    }
}