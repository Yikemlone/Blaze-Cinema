@using Cinema.Shared.DTO
@inherits ComponentBase

@if(SeatScreenings != null) {

    <MudStack Class="justify-center align-content-center pa-10 ma-2" Justify="Justify.Center">

        <MudGrid Justify="Justify.Center">
            <MudItem xs="12">
                <div>
                    <MudGrid Style="width: 300px">
                            @foreach (var seat in SeatScreenings)
                            {
                                <MudItem Style="padding: 0px">
                                    <Seat OnSeatSelected="SeatSelected" SeatScreening="@seat" />
                                </MudItem>
                            }

                        <MudItem>
                            <p>Screen Here</p>
                        </MudItem>

                    </MudGrid>
                </div>

            </MudItem>

            <MudItem>
                <MudButton Variant="Variant.Filled" ButtonType="ButtonType.Button" Color="Color.Secondary" OnClick="OnSelected">
                    Save Seats
                </MudButton>
            </MudItem>

        </MudGrid>
    </MudStack>
}

@code {
    [Parameter] public List<SeatScreeningDTO> SeatScreenings { get; set; }
    [Parameter] public EventCallback<List<SeatScreeningDTO>> OnSeatsSelected { get; set; }

    private List<SeatScreeningDTO> _selectedSeats = new();

    protected async Task SeatSelected(SeatScreeningDTO seat)
    {
        // This will set the selected seat, unless its already in the list
        // which then it will remove it 
        if (_selectedSeats.Contains(seat))
        {
            _selectedSeats.Remove(seat);
        }
        else 
        {
            _selectedSeats.Add(seat);
        }
    }

    protected async Task OnSelected() 
    {
        // This will send all the selected seats page to booking page.
        await OnSeatsSelected.InvokeAsync(_selectedSeats);
    }
}
