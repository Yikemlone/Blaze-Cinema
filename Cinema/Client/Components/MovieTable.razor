@using System.Net.Http.Json
@using Cinema.Shared.DTO
@using static MudBlazor.CategoryTypes
@inject HttpClient httpClient

<style>
    .selected {
        background-color: #1E88E5 !important;
    }

        .selected > td {
            color: white !important;
        }

            .selected > td .mud-input {
                color: white !important;
            }
</style>

<MudContainer Class="mt-16 px-8" MaxWidth="MaxWidth.False">
    <MudGrid>
        <MudItem>
            <MudSpacer></MudSpacer>
            <MudChip Color="Color.Success">Add</MudChip>
            <MudChip Color="Color.Warning">Edit</MudChip>
            <MudChip Color="Color.Error">Delete</MudChip>
        </MudItem>

        <MudTable Items="@Movies" 
            Hover="true" 
            Breakpoint="Breakpoint.Sm" 
            @ref="mudTable" 
            RowClassFunc="@SelectedRowClassFunc" 
            OnRowClick="RowClickEvent" 
            T="MovieDTO" 
            Loading=@Loading
            LoadingProgressColor="Color.Secondary">
    
            <HeaderContent>
                <MudTh>Name</MudTh>
                <MudTh>AgeRating</MudTh>
                <MudTh>Duration</MudTh>
                <MudTh>Trailer</MudTh>
                <MudTh>Description</MudTh>
            </HeaderContent>

            <RowTemplate>
                <MudTd DataLabel="Name">@context.Name</MudTd>
                <MudTd DataLabel="AgeRating">@context.AgeRating</MudTd>
                <MudTd DataLabel="Duration">@context.Duration</MudTd>
                <MudTd DataLabel="Trailer">@context.Trailer</MudTd>
                <MudTd DataLabel="Description">@context.Description</MudTd>
            </RowTemplate>

        </MudTable>
    </MudGrid>
</MudContainer>

@code {
    private int selectedRowNumber = -1;
    private MudTable<MovieDTO>? mudTable;
    private List<string> clickedEvents = new();

    [Parameter]
    public IEnumerable<MovieDTO> Movies { get; set; } = new List<MovieDTO>();
    [Parameter]
    public bool Loading { get; set; }

    private void RowClickEvent(TableRowClickEventArgs<MovieDTO> tableRowClickEventArgs)
    {
        clickedEvents.Add("Row has been clicked");
    }

    private string SelectedRowClassFunc(MovieDTO element, int rowNumber)
    {
        if (selectedRowNumber == rowNumber)
        {
            selectedRowNumber = -1;
            clickedEvents.Add("Selected Row: None");
            return string.Empty;
        }
        else if (mudTable.SelectedItem != null && mudTable.SelectedItem.Equals(element))
        {
            selectedRowNumber = rowNumber;
            clickedEvents.Add($"Selected Row: {rowNumber}");
            return "selected";
        }
        else
        {
            return string.Empty;
        }
    }
}