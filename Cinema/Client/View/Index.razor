@page "/"
@using Cinema.Shared.DTO

<PageTitle>Blaze Cinema</PageTitle>

<MudContainer Class="mt-16 px-8" MaxWidth="MaxWidth.False">

    <MudItem xs="12" sm="6" md="4">
        <MovieSelect/>
    </MudItem>

    <MudGrid>
        @if (Movies.Count != 0)
        {
            @foreach(var movie in Movies)
            {
                <MudItem xs="12" sm="6" md="4">
                    @*<MudPaper Elevation="2" Class="pa-4" Style="height: 100%">*@
                            <MovieThumbnail Movie=@movie/>
                    @*</MudPaper>*@
                </MudItem>
            }
        } else 
        {
            @for (var i = 0; i < 10; i++)
            {
                <MudItem xs="12" sm="6" md="4">
                    <MudCard>
                        <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="200px"/>
                        <MudCardContent>
                            <MudSkeleton Width="30%" Height="42px;" />
                            <MudSkeleton Width="80%" />
                            <MudSkeleton Width="100%" />
                        </MudCardContent>
                        <MudCardActions>
                            <MudSkeleton Width="64px" Height="40px" Class="ml-2" />
                            <MudSkeleton Width="105px" Height="40px" Class="ml-3" />
                        </MudCardActions>
                    </MudCard>
                </MudItem>
            }
        }
    </MudGrid>
</MudContainer>

@code
{
    private const string API_URL = "api/movie";
    private HttpClient _client;
    public List<MovieDTO> Movies { get; set; } = new List<MovieDTO>();
    public List<ScreeningDTO> Screenings { get; set; } // This will used inside of the movie details page.


    protected override async Task OnInitializedAsync()
    {
        _client = new HttpClient() { BaseAddress = new Uri("https://localhost:7016") };
        Movies = await GetMoviesAsync();
    }

    public async Task<List<MovieDTO>> GetMoviesAsync()
    {
        return await _client.GetFromJsonAsync<List<MovieDTO>>(API_URL + "/movies");
    }
}